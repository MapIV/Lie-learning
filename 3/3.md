:::note info
ç›®æ¨™ï¼šæŒ‡æ•°å†™åƒã¨å¯¾æ•°å†™åƒã‚’ç†è§£ã—ã‚ˆã†
:::

æœ¬è¨˜äº‹ã¯ã“ã¡ã‚‰ã‚’å…ƒã«è§£èª¬ã™ã‚‹
[Lie Groups for 2D and 3D Transformations](https://www.ethaneade.com/lie.pdf)


# 1. æ¦‚è¦
## 1.1 æŒ‡æ•°å†™åƒã¨å¯¾æ•°å†™åƒã«ã¤ã„ã¦
ãƒªãƒ¼ç¾¤ã¨ãƒªãƒ¼ä»£æ•°ã®é–“ã®å¤‰æ›ã¯æŒ‡æ•°å†™åƒ(Exponential map)ã€å¯¾æ•°å†™åƒ(Logarithmic map)ã‚’ç”¨ã„ã¦è¡Œã†ã€‚  
([å†™åƒã®å¾©ç¿’](https://mathlandscape.com/bijection/))

**æŒ‡æ•°å†™åƒ**ã¯ã€ãƒªãƒ¼ä»£æ•° $\boldsymbol{\mathfrak{g}}$ ã®å…ƒã‚’ã€å¯¾å¿œã™ã‚‹ãƒªãƒ¼ç¾¤ $G$ ã®å…ƒã«å†™åƒã™ã‚‹æ“ä½œã€‚

~~~math
\exp: \boldsymbol{\mathfrak{g}} \to G
~~~

**å¯¾æ•°å†™åƒ**ã¯ã€ãƒªãƒ¼ç¾¤ $G$ ã®å…ƒã‚’ã€ãƒªãƒ¼ä»£æ•° $\boldsymbol{\mathfrak{g}}$ ã®å…ƒã«å†™åƒã™ã‚‹æ“ä½œã€‚

~~~math
\log: G \to \boldsymbol{\mathfrak{g}}
~~~

## 1.2 SO(2)ã§ãƒ‡ãƒ¢
**æŒ‡æ•°å†™åƒã®ãƒ‡ãƒ¢**ï¼š [Lie-learning/3/exp_test.py](https://github.com/MapIV/Lie-learning)

![exp_test.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1294864/54d9e62d-1157-49f3-b94e-f0b6877ca18e.png)

**ãƒªãƒ¼ç¾¤**
~~~math
R = \begin{pmatrix} \cos \theta & -\sin \theta \\ \sin \theta & \cos \theta \end{pmatrix} \in SO(2)
~~~

**ãƒªãƒ¼ä»£æ•°**
~~~math
\theta \in \mathbb{R}, \quad J = \begin{pmatrix} 0 & -1 \\ 1 & 0 \end{pmatrix}, \\ \quad [\boldsymbol{\theta}]_\times = \begin{pmatrix} 0 & -\theta \\ \theta & 0 \end{pmatrix} \in \mathfrak{so}(2)
~~~

**exp map**
~~~math
R = \exp([\boldsymbol{\theta}]_\times) = \begin{pmatrix} \cos \theta & -\sin \theta \\ \sin \theta & \cos \theta \end{pmatrix} \in SO(2) 
~~~

**log map**
~~~math
\log(R) = [\boldsymbol{\theta}]_\times = \arctan({R_{12}},{R_{11}}) \in \mathfrak{so}(2)
~~~

**$SO(2)$ã¨$\mathfrak{so}(2)$ã®é–¢ä¿‚å›³**
```mermaid
graph LR;
    subgraph "SO(2)"
        A[R]
    end
    subgraph "so(2)"
        B["[Î¸]Ã—"]
    end
    B -- "exp([Î¸]Ã—)" --> A
    A -- "log(R)" --> B
```

# 2. SO(3)
## 2.1 æŒ‡æ•°å†™åƒ (Exponential map)
### è¨ˆç®—å¼
~~~math
[\boldsymbol{\omega}]_\times \in \mathfrak{so}(3), \quad \boldsymbol{\omega} \in \mathbb{R}^3, \quad \theta = \|\boldsymbol{\omega}\|
~~~

~~~math
\exp([\boldsymbol{\omega}]_\times) = \boldsymbol{I} + \left( \frac{\sin \theta}{\theta} \right) [\boldsymbol{\omega}]_\times + \left( \frac{1 - \cos \theta}{\theta^2} \right) [\boldsymbol{\omega}]_\times^2
~~~

### å¼ã®å°å‡º
$\mathfrak{so}(3)$ ã‹ã‚‰ $SO(3)$ ã¸ã®æŒ‡æ•°å†™åƒã¯ã€è¡Œåˆ—æŒ‡æ•°é–¢æ•°ã‚’ç”¨ã„ã¦ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚

~~~math
\exp([\boldsymbol{\omega}]_\times) = \exp \left( \begin{pmatrix} 
0 & -\omega_3 & \omega_2 \\ 
\omega_3 & 0 & -\omega_1 \\ 
-\omega_2 & \omega_1 & 0 
\end{pmatrix} \right) = \boldsymbol{I} + [\boldsymbol{\omega}]_\times + \frac{1}{2!} [\boldsymbol{\omega}]_\times^2 + \frac{1}{3!} [\boldsymbol{\omega}]_\times^3 + \dots
~~~

ï¼ˆå‚è€ƒï¼š[CVãƒ»CGãƒ»ãƒ­ãƒœãƒ†ã‚£ã‚¯ã‚¹ã®ãŸã‚ã®ãƒªãƒ¼ç¾¤ãƒ»ãƒªãƒ¼ä»£æ•°å…¥é–€: (2) è¡Œåˆ—æŒ‡æ•°é–¢æ•°](https://swkagami.hatenablog.com/entry/lie_02exp#%E8%A1%8C%E5%88%97%E5%AF%BE%E6%95%B0%E9%96%A2%E6%95%B0)ï¼‰

é …ã‚’ãƒšã‚¢ã§æ›¸ãã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ã€‚

~~~math
\exp([\boldsymbol{\omega}]_\times) = \boldsymbol{I} + \sum_{i=0}^{\infty} \left[ \frac{1}{(2i+1)!} [\boldsymbol{\omega}]_\times^{2i+1} + \frac{1}{(2i+2)!} [\boldsymbol{\omega}]_\times^{2i+2} \right]
~~~

ã“ã“ã§ã€æ­ªå¯¾ç§°è¡Œåˆ—ã®ç‰¹æ€§ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

~~~math
[\boldsymbol{\omega}]_\times^3 = -(\boldsymbol{\omega}^T \boldsymbol{\omega}) \cdot [\boldsymbol{\omega}]_\times 
~~~

~~~math
\theta^2 \equiv \boldsymbol{\omega}^T \boldsymbol{\omega}
~~~

$[\boldsymbol{\omega}] \_\times$ã‚’3å›ã‹ã‘ã‚‹ã¨ã€å…ƒã®$[\boldsymbol{\omega}] \_\times$ã«ã‚¹ã‚«ãƒ©ãƒ¼$-\theta^2$ã‚’ã‹ã‘ãŸã‚‚ã®ã«æˆ»ã‚‹ã¨ã„ã†å‘¨æœŸçš„ãªæ€§è³ªã‚’æŒã£ã¦ã„ã‚‹ã€‚å¾“ã£ã¦ã€æ¬¡ã®ã‚ˆã†ãªä¸€èˆ¬å¼ã§è¡¨ã›ã‚‹ã€‚

~~~math
[\boldsymbol{\omega}]_\times^{2i+1} = (-1)^i \theta^{2i} [\boldsymbol{\omega}]_\times
~~~

~~~math
[\boldsymbol{\omega}]_\times^{2i+2} = (-1)^i \theta^{2i} [\boldsymbol{\omega}]_\times^2
~~~

æŒ‡æ•°å†™åƒã®ç´šæ•°ã‚’å› æ•°åˆ†è§£ã—ã¦ã€ä¿‚æ•°ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«é–‰å½¢å¼ã§è¡¨ã™ã“ã¨ãŒã§ãã‚‹ã€‚

~~~math
\begin{align}
\exp([\boldsymbol{\omega}]_\times) &= \boldsymbol{I} + \left( \sum_{i=0}^{\infty} \frac{(-1)^i \theta^{2i}}{(2i+1)!} \right) [\boldsymbol{\omega}]_\times + \left( \sum_{i=0}^{\infty} \frac{(-1)^i \theta^{2i}}{(2i+2)!} \right) [\boldsymbol{\omega}]_\times^2 \tag{1}\\
&= \boldsymbol{I} + \left( 1 - \frac{\theta^2}{3!} + \frac{\theta^4}{5!} - \dots \right) [\boldsymbol{\omega}]_\times + \left( \frac{1}{2!} - \frac{\theta^2}{4!} + \frac{\theta^4}{6!} - \dots \right) [\boldsymbol{\omega}]_\times^2 \tag{2}\\
&= \boldsymbol{I} + \left( \frac{\sin \theta}{\theta} \right) [\boldsymbol{\omega}]_\times + \left( \frac{1 - \cos \theta}{\theta^2} \right) [\boldsymbol{\omega}]_\times^2 \tag{3}
\end{align}
~~~

å¼(2)ã‹ã‚‰å¼(3)ã¸ã®å¤‰æ›ã¯ã€$\sin \theta$ã¨$\cos \theta$ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€‚
~~~math
\sin \theta = \theta - \frac{\theta^3}{3!} + \frac{\theta^5}{5!} - \dots
~~~
~~~math
\cos \theta = 1 - \frac{\theta^2}{2!} + \frac{\theta^4}{4!} - \dots
~~~

å¼(3)ã¯æœ‰åãªãƒ­ãƒ‰ãƒªã‚²ã‚¹ã®å…¬å¼ã§ã‚ã‚‹ã€‚æŒ‡æ•°å†™åƒã®çµæœã¯ã€$\boldsymbol{\omega}$ ã«ã‚ˆã£ã¦ä¸ãˆã‚‰ã‚Œã‚‹è»¸å‘¨ã‚Šã‚’ $\theta$ ãƒ©ã‚¸ã‚¢ãƒ³å›è»¢ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚

$\theta$ ãŒå°ã•ã„å ´åˆã¯ã€å¼(2)ã®ã‚ˆã†ã«ä¿‚æ•°$\left( \frac{\sin \theta}{\theta} \right)$ã¨$\left( \frac{1 - \cos \theta}{\theta^2} \right)$ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ï¼ˆæ©Ÿæ¢°ç²¾åº¦ã‚’è€ƒæ…®ã—ã¦é©åˆ‡ãªé …æ•°ã‚’é¸æŠï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã§ã‚ã‚‹ã€‚

## 2.2 å¯¾æ•°å†™åƒ (Logarithm map)
### è¨ˆç®—å¼
~~~math
\boldsymbol{R} \in SO(3), \quad \theta = \arccos\left(\frac{\mathrm{tr}(\boldsymbol{R}) - 1}{2}\right)
~~~
~~~math
\ln(\boldsymbol{R}) = \frac{\theta}{2\sin\theta} \cdot (\boldsymbol{R} - \boldsymbol{R}^T)
~~~

### å¼ã®å°å‡º
Logmapã¯æŒ‡æ•°å†™åƒã®é€†ã®æ“ä½œã§ã‚ã‚‹ãŸã‚ã€æŒ‡æ•°å†™åƒã®å¼ã‹ã‚‰å°å‡ºã™ã‚‹ã€‚

**$\theta$ ã®å°å‡º**

å¼(3)ã®ä¸¡è¾ºã®ãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆtrace, å¯¾è§’æˆåˆ†ã®å’Œï¼‰ã‚’è¨ˆç®—ã™ã‚‹ã€‚å„é …ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

-   $\mathrm{tr}(\boldsymbol{I}) = 3$
-   $\mathrm{tr}([\boldsymbol{\omega}]\_\times) = 0$ ï¼ˆæ­ªå¯¾ç§°è¡Œåˆ—ã®å¯¾è§’æˆåˆ†ã¯å…¨ã¦0ã®ãŸã‚ï¼‰
-   $\mathrm{tr}([\boldsymbol{\omega}]\_\times^2) = -2\theta^2$ ï¼ˆ$[\boldsymbol{\omega}]_\times^2 = \boldsymbol{\omega}\boldsymbol{\omega}^T - (\boldsymbol{\omega}^T\boldsymbol{\omega})\boldsymbol{I}$ ã¨ $\theta^2 = \boldsymbol{\omega}^T\boldsymbol{\omega}$ ã‚ˆã‚Šï¼‰

ã“ã‚Œã‚‰ã‚’ä½¿ã£ã¦å¼(3)ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’è¨ˆç®—ã™ã‚‹ã¨ã€

~~~math
\begin{align}
\mathrm{tr}(\boldsymbol{R}) &= \mathrm{tr}(\boldsymbol{I}) + \left( \frac{\sin \theta}{\theta} \right) \mathrm{tr}([\boldsymbol{\omega}]_\times) + \left( \frac{1 - \cos \theta}{\theta^2} \right) \mathrm{tr}([\boldsymbol{\omega}]_\times^2) \notag \\
&= 3 + \left( \frac{\sin \theta}{\theta} \right) \cdot 0 + \left( \frac{1 - \cos \theta}{\theta^2} \right) (-2\theta^2) \notag \\
&= 3 - 2(1 - \cos \theta) \notag \\
&= 1 + 2\cos \theta \notag
\end{align}
~~~

ã“ã®å¼ã‚’ $\theta$ ã«ã¤ã„ã¦è§£ãã¨ã€ç›®çš„ã®å¼ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚

~~~math
\cos \theta = \frac{\mathrm{tr}(\boldsymbol{R}) - 1}{2} \quad \Rightarrow \quad \theta = \arccos\left(\frac{\mathrm{tr}(\boldsymbol{R}) - 1}{2}\right)
~~~

**$[\boldsymbol{\omega}]\_\times$ ã®å°å‡º**


$\boldsymbol{R}^T$ ã¯ã€æ­ªå¯¾ç§°è¡Œåˆ—ã®æ€§è³ª $([\boldsymbol{\omega}]\_\times)^T = -[\boldsymbol{\omega}]\_\times$ ã¨ã€å¯¾ç§°è¡Œåˆ—ã®æ€§è³ª $([\boldsymbol{\omega}]\_\times^2)^T = [\boldsymbol{\omega}]\_\times^2$ ã‚’ä½¿ã†ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

~~~math
\boldsymbol{R}^T = \boldsymbol{I} - \left( \frac{\sin \theta}{\theta} \right) [\boldsymbol{\omega}]_\times + \left( \frac{1 - \cos \theta}{\theta^2} \right) [\boldsymbol{\omega}]_\times^2 \quad \cdots \tag{4}
~~~

å¼(3)ã‹ã‚‰å¼(4)ã‚’å¼•ãã¨ã€

~~~math
\boldsymbol{R} - \boldsymbol{R}^T = 2 \frac{\sin \theta}{\theta} [\boldsymbol{\omega}]_\times
~~~

ã“ã®å¼ã‚’ $[\boldsymbol{\omega}]\_\times$ ã«ã¤ã„ã¦è§£ãã€‚$\ln(\boldsymbol{R}) = [\boldsymbol{\omega}]\_\times$ ã§ã‚ã‚‹ãŸã‚ã€ã“ã‚ŒãŒLogmapã®å¼ã¨ãªã‚‹ã€‚

~~~math
\ln(\boldsymbol{R}) = [\boldsymbol{\omega}]_\times = \frac{\theta}{2\sin\theta} (\boldsymbol{R} - \boldsymbol{R}^T)
~~~

$\theta$ãŒ0ã«è¿‘ã„å ´åˆã¯ã€ä¿‚æ•°$\frac{\theta}{2\sin\theta}$ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã‚’ä½¿ç”¨ã™ã¹ãã§ã‚ã‚‹ã€‚

## 2.3 å®Ÿè£…
ğŸ’»**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã™ã‚‹**
- å›è»¢ã«é–¢ã™ã‚‹å®Ÿè£…ï¼š[Rot3.h](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/Rot3.h#L58-L59)
- æŒ‡æ•°å†™åƒã®å®Ÿè£…ï¼š[SO3.cpp gtsam::so3::ExpmapFunctor::expmap()](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/SO3.cpp#L112)
- $\theta$ãŒ0ã«è¿‘ã„å ´åˆã®å‡¦ç†ï¼š[SO3.cpp gtsam::so3::ExpmapFunctor::init()](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/SO3.cpp#L86) 
- å¯¾æ•°å†™åƒã®å®Ÿè£…ï¼š[SO3.cpp gtsam::SO3::Logmap()](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/SO3.cpp#L298)

âŒ¨**å®Ÿè£…ä¾‹**
```c++
#include <gtsam/geometry/Rot3.h>
#include <iostream>

int main() {
    using namespace gtsam;

    // é©å½“ãªå›è»¢è¡Œåˆ—
    Rot3 R = Rot3::RzRyRx(0.1, -0.2, 0.3);

    // å›è»¢è¡Œåˆ— -> å›è»¢ãƒ™ã‚¯ãƒˆãƒ«
    Vector3 omega = R.log();

    // å›è»¢ãƒ™ã‚¯ãƒˆãƒ« -> å›è»¢è¡Œåˆ—
    Rot3 R_recovered = Rot3::Expmap(omega);

    return 0;
}
```


# 3. SE(3)
## 3.1 æŒ‡æ•°å†™åƒ (Exponential map)
### è¨ˆç®—å¼
~~~math
\boldsymbol{\delta} = (\boldsymbol{u} \quad \boldsymbol{\omega}) \in \mathbb{R}^3, \quad \theta = \|\boldsymbol{\omega}\|
~~~

~~~math
\boldsymbol{\delta}^\wedge = \begin{pmatrix}
[\boldsymbol{\omega}]_\times & \boldsymbol{u} \\
0 & 0
\end{pmatrix} \in \mathfrak{se}(3)
~~~

~~~math
A = \frac{\sin \theta}{\theta}, \quad B = \frac{1 - \cos \theta}{\theta^2}, \quad C = \frac{1 - A}{\theta^2}
~~~

~~~math
\boldsymbol{R} = \boldsymbol{I} + A[\boldsymbol{\omega}]_\times + B[\boldsymbol{\omega}]_\times^2
~~~

~~~math
V = \boldsymbol{I} + B[\boldsymbol{\omega}]_\times + C[\boldsymbol{\omega}]_\times^2
~~~

~~~math
\exp\left(
\begin{pmatrix}
\boldsymbol{u} \\
\boldsymbol{\omega}
\end{pmatrix}
\right) = \begin{pmatrix} \boldsymbol{R} & V\boldsymbol{u} \\ 0 & 1 \end{pmatrix}
~~~


### å¼ã®å°å‡º
$\mathfrak{se}(3)$ ã‹ã‚‰$SE(3)$ã¸ã®æŒ‡æ•°å†™åƒã¯ã€è¡Œåˆ—æŒ‡æ•°é–¢æ•°ã‚’ç”¨ã„ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

~~~math
\boldsymbol{\delta}^\wedge = \begin{pmatrix}
[\boldsymbol{\omega}]_\times & \boldsymbol{u} \\
0 & 0
\end{pmatrix} \in \mathfrak{se}(3)
~~~

~~~math
\exp(\boldsymbol{\delta}) = \boldsymbol{I} + \boldsymbol{\delta} + \frac{1}{2!}\boldsymbol{\delta}^{\wedge^{2}} + \frac{1}{3!}\boldsymbol{\delta}^{\wedge^{3}} + \cdots
~~~

ã“ã“ã§ã€

~~~math
\boldsymbol{\delta}^{\wedge^{2}} = \begin{pmatrix} [\boldsymbol{\omega}]_\times & \boldsymbol{u} \\ 0 & 0 \end{pmatrix} \begin{pmatrix} [\boldsymbol{\omega}]_\times & \boldsymbol{u} \\ 0 & 0 \end{pmatrix} = \begin{pmatrix} [\boldsymbol{\omega}]_\times^2 & [\boldsymbol{\omega}]_\times \boldsymbol{u} \\ 0 & 0 \end{pmatrix}
~~~

~~~math
\boldsymbol{\delta}^{\wedge^{3}} = \begin{pmatrix} [\boldsymbol{\omega}]_\times & \boldsymbol{u} \\ 0 & 0 \end{pmatrix} \begin{pmatrix} [\boldsymbol{\omega}]_\times^2 & [\boldsymbol{\omega}]_\times \boldsymbol{u} \\ 0 & 0 \end{pmatrix} = \begin{pmatrix} [\boldsymbol{\omega}]_\times^3 & [\boldsymbol{\omega}]_\times^2 \boldsymbol{u} \\ 0 & 0 \end{pmatrix}
~~~

ãªã®ã§ã€

~~~math
\exp(\boldsymbol{\delta}^\wedge) = \boldsymbol{I} + \begin{pmatrix} [\boldsymbol{\omega}]_\times & \boldsymbol{u} \\ 0 & 0 \end{pmatrix} + \frac{1}{2!} \begin{pmatrix} [\boldsymbol{\omega}]_\times^2 & [\boldsymbol{\omega}]_\times \boldsymbol{u} \\ 0 & 0 \end{pmatrix} + \frac{1}{3!} \begin{pmatrix} [\boldsymbol{\omega}]_\times^3 & [\boldsymbol{\omega}]_\times^2 \boldsymbol{u} \\ 0 & 0 \end{pmatrix} + \cdots
~~~

å›è»¢ãƒ–ãƒ­ãƒƒã‚¯ã¯$SO(3)$ã¨åŒã˜ã§ã‚ã‚‹ãŒã€ä¸¦é€²æˆåˆ†ã¯ç•°ãªã‚‹ã¹ãç´šæ•°ã«ãªã‚‹ã€‚

~~~math
\exp\left(
\begin{pmatrix}
[\boldsymbol{\omega}]_\times & \boldsymbol{u} \\
0 & 0
\end{pmatrix}
\right) = \begin{pmatrix} \exp([\boldsymbol{\omega}]_\times) & V\boldsymbol{u} \\ 0 & 1 \end{pmatrix}
~~~

~~~math
V = \boldsymbol{I} + \frac{1}{2!}[\boldsymbol{\omega}]_\times + \frac{1}{3!}[\boldsymbol{\omega}]_\times^2 + \cdots
~~~

é …ã‚’å¥‡æ•°ä¹—ã¨å¶æ•°ä¹—ã«åˆ†å‰²ã—ã€å› æ•°åˆ†è§£ã™ã‚‹ã€‚

~~~math
V = \boldsymbol{I} + \sum_{i=0}^{\infty} \left[\frac{1}{(2i+2)!}[\boldsymbol{\omega}]_\times^{2i+1} + \frac{1}{(2i+3)!}[\boldsymbol{\omega}]_\times^{2i+2}\right]
~~~

~~~math
= \boldsymbol{I} + \left( \sum_{i=0}^{\infty} \frac{(-1)^i \theta^{2i}}{(2i+2)!} \right) [\boldsymbol{\omega}]_\times + \left( \sum_{i=0}^{\infty} \frac{(-1)^i \theta^{2i}}{(2i+3)!} \right) [\boldsymbol{\omega}]_\times^2
~~~

ä¿‚æ•°ã¯ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã§ã€

~~~math
\sum_{i=0}^{\infty} \frac{(-1)^i \theta^{2i}}{(2i+2)!} = \frac{1}{2!} - \frac{\theta^2}{4!} + \frac{\theta^4}{6!} - \cdots = \frac{1 - \cos \theta}{\theta^2}
~~~

~~~math
\sum_{i=0}^{\infty} \frac{(-1)^i \theta^{2i}}{(2i+3)!} = \frac{1}{3!} - \frac{\theta^2}{5!} + \frac{\theta^4}{7!} - \cdots = \frac{\theta - \sin \theta}{\theta^3}
~~~

ã¨ãªã‚Šã€Vã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ã€‚

~~~math
V = \boldsymbol{I} + \left( \frac{1 - \cos \theta}{\theta^2} \right) [\boldsymbol{\omega}]_\times + \left( \frac{\theta - \sin \theta}{\theta^3} \right) [\boldsymbol{\omega}]_\times^2
~~~

$\theta^2$ãŒå°ã•ã„å ´åˆã€$A, B, C$ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã‚’ä½¿ç”¨ã™ã¹ãã§ã‚ã‚‹ã€‚

## 3.2 å¯¾æ•°å†™åƒ (Logarithm map)
### è¨ˆç®—å¼
~~~math
T = \begin{pmatrix} \boldsymbol{R} & \boldsymbol{t} \\ 0 & 1 \end{pmatrix} \in SE(3), \quad
\ln(T) = \begin{pmatrix} [\boldsymbol{\omega}]_\times & \boldsymbol{u} \\ 0 & 0 \end{pmatrix} \in \mathfrak{se}(3)
~~~

å›è»¢éƒ¨åˆ†ã®$\ln$ã¯ $SO(3)$ ã¨åŒæ§˜ã§ã‚ã‚‹ã€‚
ä¸¦é€²éƒ¨åˆ†ã¯æ¬¡ã§ä¸ãˆã‚‰ã‚Œã‚‹ã€‚

~~~math
\boldsymbol{u} = V^{-1}\,\boldsymbol{t}
~~~

~~~math
V^{-1} = \boldsymbol{I} - \frac{1}{2} [\boldsymbol{\omega}]_\times + \frac{1}{\theta^2} \left(1 - \frac{A}{2B}\right) [\boldsymbol{\omega}]_\times^2
~~~

### å°å‡º

æŒ‡æ•°å†™åƒã«ãŠã„ã¦ã€$V$ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚ŒãŸã€‚

~~~math
V = \boldsymbol{I} + A[\boldsymbol{\omega}]_\times + B[\boldsymbol{\omega}]_\times^2
~~~

ã“ã“ã§ã€$A = \frac{1-\cos\theta}{\theta^2}$ã€$B = \frac{\theta-\sin\theta}{\theta^3}$ã§ã‚ã‚‹ã€‚

$V^{-1}$ã‚’æ±‚ã‚ã‚‹ãŸã‚ã«ã€$V$ã®é€†è¡Œåˆ—ã‚’ç›´æ¥è¨ˆç®—ã™ã‚‹ä»£ã‚ã‚Šã«ã€$V$ã¨åŒã˜å½¢ã®è¡Œåˆ—ã‚’ä»®å®šã™ã‚‹ã€‚

~~~math
V^{-1} = \boldsymbol{I} + \alpha[\boldsymbol{\omega}]_\times + \beta[\boldsymbol{\omega}]_\times^2
~~~

$V \cdot V^{-1} = \boldsymbol{I}$ã®æ¡ä»¶ã‹ã‚‰ã€ä¿‚æ•°$\alpha$ã¨$\beta$ã‚’æ±‚ã‚ã‚‹ã€‚

~~~math
(\boldsymbol{I} + A[\boldsymbol{\omega}]_\times + B[\boldsymbol{\omega}]_\times^2)(\boldsymbol{I} + \alpha[\boldsymbol{\omega}]_\times + \beta[\boldsymbol{\omega}]_\times^2) = \boldsymbol{I}
~~~

å·¦è¾ºã‚’å±•é–‹ã™ã‚‹ã¨ï¼š

~~~math
\begin{align}
&= \boldsymbol{I} + \alpha[\boldsymbol{\omega}]_\times + \beta[\boldsymbol{\omega}]_\times^2 \nonumber \\
&\quad + A[\boldsymbol{\omega}]_\times + A\alpha[\boldsymbol{\omega}]_\times^2 + A\beta[\boldsymbol{\omega}]_\times^3 \nonumber \\
&\quad + B[\boldsymbol{\omega}]_\times^2 + B\alpha[\boldsymbol{\omega}]_\times^3 + B\beta[\boldsymbol{\omega}]_\times^4 \nonumber
\end{align}
~~~

$[\boldsymbol{\omega}]\_\times^3 = -\theta^2[\boldsymbol{\omega}]\_\times$ãŠã‚ˆã³$[\boldsymbol{\omega}]\_\times^4 = -\theta^2[\boldsymbol{\omega}]\_\times^2$ã®æ€§è³ªã‚’ç”¨ã„ã¦æ•´ç†ã™ã‚‹ã¨ï¼š

~~~math
\begin{align}
&= \boldsymbol{I} + (A + \alpha)[\boldsymbol{\omega}]_\times \nonumber \\
&\quad + (B + A\alpha + \beta)[\boldsymbol{\omega}]_\times^2 \nonumber \\
&\quad + (-A\beta\theta^2 - B\alpha\theta^2)[\boldsymbol{\omega}]_\times \nonumber \\
&\quad + (-B\beta\theta^2)[\boldsymbol{\omega}]_\times^2 \nonumber
\end{align}
~~~

~~~math
= \boldsymbol{I} + (A + \alpha - A\beta\theta^2 - B\alpha\theta^2)[\boldsymbol{\omega}]_\times + (B + A\alpha + \beta - B\beta\theta^2)[\boldsymbol{\omega}]_\times^2
~~~

ã“ã‚ŒãŒ$\boldsymbol{I}$ã«ç­‰ã—ããªã‚‹ãŸã‚ã«ã¯ã€å„æ¬¡æ•°ã®ä¿‚æ•°ãŒã‚¼ãƒ­ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼š

- $[\boldsymbol{\omega}]\_\times$ã®ä¿‚æ•°ï¼š$A + \alpha - A\beta\theta^2 - B\alpha\theta^2 = 0$
- $[\boldsymbol{\omega}]\_\times^2$ã®ä¿‚æ•°ï¼š$B + A\alpha + \beta - B\beta\theta^2 = 0$

1æ¬¡è¿‘ä¼¼ã§ã¯é«˜æ¬¡é …ã‚’ç„¡è¦–ã—ã¦ï¼š
- $A + \alpha = 0$ ã‚ˆã‚Š $\alpha = -A = -\frac{1-\cos\theta}{\theta^2}$
- $B + A\alpha + \beta = 0$ ã‚ˆã‚Š $\beta = -B - A\alpha = -B + A^2$

$A = \frac{1-\cos\theta}{\theta^2}$ã€$B = \frac{\theta-\sin\theta}{\theta^3}$ã‚’ç”¨ã„ã¦è¨ˆç®—ã™ã‚‹ã¨ï¼š

~~~math
\alpha = -\frac{1}{2}, \quad \beta = \frac{1}{\theta^2}\left(1 - \frac{A}{2B}\right)
~~~

ã—ãŸãŒã£ã¦ï¼š

~~~math
V^{-1} = \boldsymbol{I} - \frac{1}{2}[\boldsymbol{\omega}]_\times + \frac{1}{\theta^2}\left(1 - \frac{A}{2B}\right)[\boldsymbol{\omega}]_\times^2
~~~



## 3.3 å®Ÿè£…
ğŸ’»**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã‚ˆã†**
- å‰›ä½“å¤‰æ›ã«é–¢ã™ã‚‹å®Ÿè£…ï¼š[Pose3.h](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/Pose3.h#L37)
- æŒ‡æ•°å†™åƒã®å®Ÿè£…ï¼š[Pose3.cpp gtsam::Pose3::Expmap()](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/Pose3.cpp#L217)
- å¯¾æ•°å†™åƒã®å®Ÿè£…ï¼š[Pose3.cpp gtsam::Pose3::Logmap()](https://github.com/borglab/gtsam/blob/f65a66194b10a78df2abf877bccb65d490514a46/gtsam/geometry/Pose3.cpp#L257)

âŒ¨**å®Ÿè£…ä¾‹**
```c++
#include <gtsam/geometry/Pose3.h>
#include <gtsam/geometry/Rot3.h>
#include <gtsam/base/Vector.h>
#include <iostream>

int main() {
  using namespace gtsam;

  // é©å½“ãªPose3ï¼ˆå›è»¢ï¼‹ä¸¦é€²ï¼‰
  Pose3 T(Rot3::RzRyRx(0.1, -0.2, 0.3), Point3(1.0, 2.0, 3.0));

  // Pose3 -> se(3)ï¼ˆVector6: [omega(3), v(3)]ï¼‰
  Vector6 xi = Pose3::Logmap(T);

  // se(3) -> Pose3
  Pose3 T_recovered = Pose3::Expmap(xi);

  return 0;
}
```

## ã¾ã¨ã‚
- ãƒªãƒ¼ä»£æ•°ã‹ã‚‰ãƒªãƒ¼ç¾¤ã¸ã®å¤‰æ›ã¯æŒ‡æ•°å†™åƒã€ãƒªãƒ¼ç¾¤ã‹ã‚‰ãƒªãƒ¼ä»£æ•°ã¸ã®å¤‰æ›ã¯å¯¾æ•°å†™åƒã‚’ç”¨ã„ã‚‹ã€‚
- $\mathfrak{so}(3)$ ã‹ã‚‰ $SO(3)$ ã¸ã®æŒ‡æ•°å†™åƒã¯ãƒ­ãƒ‰ãƒªã‚²ã‚¹ã®å…¬å¼ã¨ãªã£ã¦ã„ã‚‹ã€‚
- æœ€å¾Œã«ã€[IMU Preintegration on Manifold for Efficient Visual-Inertial Maximum-a-Posteriori Estimation](https://www.roboticsproceedings.org/rss11/p06.pdf)ã®å¼(6)ã¾ã§èª­ã‚ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã™ã‚‹ã€‚
